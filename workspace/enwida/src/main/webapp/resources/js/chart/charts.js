(function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("util/logger",[],function(){var t;return t=function(){function t(t){this.env=t!=null?t:"production",this.logDebug=e(this.logDebug,this),this.logWarning=e(this.logWarning,this),this.logError=e(this.logError,this),this.logCurried=e(this.logCurried,this)}return t.prototype.levels=["ERROR","WARNING","DEBUG"],t.prototype.envLevels={debug:2,testing:1,production:0},t.prototype.isLogLevel=function(e){return e<=this.envLevels[this.env]},t.prototype.log=function(e,t,n){var r;arguments.length===1?(n=e,e=null,t=2):arguments.length===2&&(n=t,typeof e=="number"?(t=e,e=null):t=2);if(this.isLogLevel(t))return r=e!=null?""+e+": ":"",console.log("["+this.levels[t]+"] "+r+n)},t.prototype.logCurried=function(e){var t=this;return function(n){return function(r){return t.log(e,n,r)}}},t.prototype.logError=function(e){var t=this;return function(n){return t.log(e,0,n)}},t.prototype.logWarning=function(e){var t=this;return function(n){return t.log(e,1,n)}},t.prototype.logDebug=function(e){var t=this;return function(n){return t.log(e,2,n)}},t}(),{init:function(e){return new t(e)}}})}).call(this),function(){define("util/scale",[],function(){var e=this;return{init:function(e){var t,n;return this.chart=e,this.options=this.chart.options.scale,this.setupXScale(),this.setupYScale(),this.setupDomain(this.chart.xScale,"x"),this.setupDomain(this.chart.yScale,"y"),typeof (t=this.chart.xScale).nice=="function"&&t.nice(),typeof (n=this.chart.yScale).nice=="function"?n.nice():void 0},setupXScale:function(){if(!(this.options&&this.options.x&&this.options.x.type)){this.setupXScaleLinear();return}switch(this.options.x.type){case"linear":return this.setupXScaleLinear();case"ordinal":return this.setupXScaleOrdinal();case"date":return this.setupXScaleDate()}},setupYScale:function(){var e,t;if(!((e=this.options)!=null?(t=e.y)!=null?t.type:void 0:void 0)){this.setupYScaleLinear();return}switch(this.options.y.type){case"ordinal":return this.setupYScaleOrdinal();default:return this.setupYScaleLinear()}},setupXScaleLinear:function(){return this.chart.xScale=d3.scale.linear().range([0,this.chart.options.width])},setupYScaleOrdinal:function(){var e,t,n;return(t=this.options["y"])["domain"]==null&&(t.domain={type:"map"}),e=(n=this.options.y.padding)!=null?n:.1,this.chart.yScale=d3.scale.ordinal().rangeRoundBands([0,this.chart.options.height],e)},setupXScaleOrdinal:function(){var e,t,n;return(t=this.options["x"])["domain"]==null&&(t.domain={type:"map"}),e=(n=this.options.x.padding)!=null?n:.1,this.chart.xScale=d3.scale.ordinal().rangeRoundBands([0,this.chart.options.width],e)},setupXScaleDate:function(){return this.chart.xScale=d3.time.scale().range([0,this.chart.options.width]),this.chart.xScale.tickFormat=function(e){return function(e){return e.getTime()}}},getTickFormater:function(e){return function(t){var n;return n=null,function(t){var r,i,s,o,u;s=function(e){return n=t,d3.time.format(e[1])(t)};if(n==null)return s(e[0]);for(o=0,u=e.length;o<u;o++){i=e[o],r=d3.time.format(i[0]);if(r(t)!==r(n))return s(i)}return s(e[e.length-1])}}},setupYScaleLinear:function(){return this.chart.yScale=d3.scale.linear().range([this.chart.options.height,0])},setupDomain:function(e,t){var n,r,i,s,o;if(this.options==null||this.options[t]==null||this.options[t]["domain"]==null||!this.options[t].domain){this.setupDomainExtent(e,t);return}r=this.options[t].domain.type;if(r instanceof Array){o=[];for(i=0,s=r.length;i<s;i++)n=r[i],o.push(this.applyStrategy(n,e,t));return o}return this.applyStrategy(r,e,t)},applyStrategy:function(e,t,n){switch(e){case"extent":return this.setupDomainExtent(t,n);case"map":return this.setupDomainMap(t,n);case"stretch":return this.setupDomainStretch(t);case"fixed":return this.setupDomainFixed(t,n);default:throw new Error("Not a valid scale type: "+e)}},setupDomainExtent:function(e,t){return e.domain(d3.extent(this.allValues(t)))},setupDomainStretch:function(e,t,n){var r;return t==null&&(t=.9),n==null&&(n=1.1),r=e.domain(),e.domain([r[0]*t,r[1]*n])},setupDomainMap:function(e,t){return e.domain(this.allValues(t))},setupDomainFixed:function(e,t){var n,r;return r=this.getBound(this.options[t].domain.low,t),n=this.getBound(this.options[t].domain.high,t),e.domain([r,n])},allValues:function(e){var t,n,r,i,s,o,u,a,f,l;t=[],s={},l=this.chart.data;for(r=o=0,a=l.length;o<a;r=++o){i=l[r];if(_(this.chart.options.disabledLines).contains(r))continue;for(u=0,f=i.length;u<f;u++)n=i[u],s[n[e]]==null&&(t.push(n[e]),s[n[e]]=!0)}return t},getBound:function(e,t){if($.isNumeric(e))return e;switch(e){case"min":return d3.min(this.chart.data,function(e){return e[t]});case"max":return d3.max(this.chart.data,function(e){return e[t]});default:throw new Error("Not a valid bound: "+e)}},getMinInterval:function(e,t){var n,r,i,s,o;t==null&&(t="x"),i=Infinity;for(r=s=0,o=e.length-2;0<=o?s<o:s>o;r=0<=o?++s:--s)n=Math.abs(e[r+1][t]-e[r][t]),n>0&&n<i&&(i=n);return i},getBarWidth:function(e,t,n){var r,i;return n==null&&(n="x"),r=e[0][n],i=this.getMinInterval(e,n),t(r+i)-t(r)}}})}.call(this),function(){define("drawable/generic_chart",["util/scale"],function(e){var t;return t=function(){function t(t){var n,r,i;if(t==null||t.lines==null)throw"No data given";n={margin:{top:20,left:80,right:20,bottom:60},width:960,height:500,parent:"body",disabledLines:[]},this.options=$.extend(n,t),this.lines=t.lines,this.xLabel=(r=this.options.xLabel)!=null?r:"",this.yLabel=(i=this.options.yLabel)!=null?i:"",this.lineLabels=this.lines.map(function(e){return e.title}),this.data=this.lines.map(function(e){return e.dataPoints}),e.init(this),this.generateAxes()}return t.prototype.generateXAxis=function(){return this.xAxis=d3.svg.axis().scale(this.xScale).orient("bottom")},t.prototype.generateYAxis=function(){return this.yAxis=d3.svg.axis().scale(this.yScale).orient("left")},t.prototype.generateAxes=function(e,t){return this.generateXAxis(),this.generateYAxis()},t.prototype.drawSvg=function(){var e,t;if(this.svg!=null)return;return t=this.options.width+this.options.margin.left+this.options.margin.right,e=this.options.height+this.options.margin.top+this.options.margin.bottom,this.svg=d3.selectAll(this.options.parent).append("svg").attr("width",t).attr("height",e),this.transferDataAttributes(this.options.parent.parent(),this.svg),this.svg=this.svg.append("g").attr("transform","translate("+this.options.margin.left+","+this.options.margin.top+")")},t.prototype.drawXAxis=function(e,t,n){return t==null&&(t=0),n==null&&(n=0),this.svg.append("g").attr("class","x axis").attr("transform","translate("+t+","+(n+this.options.height)+")").call(e).append("text").attr("x",this.options.width/2).attr("y",50).attr("text-anchor","middle").attr("font-style","italic").text(""+this.xLabel),this.options.scale.x.type==="date"&&this.makeDateScale(),this.avoidOverlaps()},t.prototype.drawYAxis=function(e){return this.svg.append("g").attr("class","y axis").call(e).append("text").attr("transform","rotate(-90),translate(-"+this.options.height/2+",-60)").attr("x",0).attr("y",0).attr("text-anchor","middle").attr("font-style","italic").text(""+this.yLabel)},t.prototype.drawLegend=function(){return},t.prototype.drawAxes=function(e,t){return e==null&&(e=0),t==null&&(t=0),this.drawXAxis(this.xAxis,e,t),this.drawYAxis(this.yAxis)},t.prototype.makeDateScale=function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y;i=(h=(p=this.options)!=null?(d=p.scale)!=null?(v=d.x)!=null?v.dateFormats:void 0:void 0:void 0)!=null?h:[["%Y","%Y-%m-%d"],["%m","%b"],["%d","%d"],["%H:%M","%H:%M"]],a=[],m=$(this.options.parent).find("g.tick text");for(f=0,c=m.length;f<c;f++)u=m[f],e=$(u),t=new Date(parseInt($(u).text().replace(/,/g,""))),a.push({element:e,date:t});o=function(e,t){return e.element.text(t(e.date)),e.element.attr("original-title",d3.time.format("%Y-%m-%d %H:%M")(e.date)),e.element.tipsy()},r=d3.time.format(i[0][1]),n=this.mostUsedDateFormat(a,i),o(a[0],r),y=[];for(s=l=1,g=a.length;1<=g?l<g:l>g;s=1<=g?++l:--l)y.push(o(a[s],n));return y},t.prototype.mostUsedDateFormat=function(e,t){var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S;if(e.length===0)return t[0];n={};for(o=d=0,b=t.length;0<=b?d<b:d>b;o=0<=b?++d:--d)n[o]=0;s=t.map(function(e){return d3.time.format(e[0])}),f=e[0];for(o=v=1,w=e.length;1<=w?v<w:v>w;o=1<=w?++v:--v){p=e[o];for(u=m=0,E=t.length;0<=E?m<E:m>E;u=0<=E?++m:--m){i=s[u],l=i(f.date),r=i(p.date);if(l!==r){n[u]+=1,f=p;break}}}c=-Infinity,h=null,S=_(n).keys();for(g=0,y=S.length;g<y;g++)a=S[g],n[a]>c&&(c=n[a],h=t[a][1]);return d3.time.format(h)},t.prototype.avoidOverlaps=function(){var e,t,n,r,i,s,o,u,a,f,l;n=0,r=0,t=!0,f=$(this.options.parent).find("g.tick text"),l=[];for(u=0,a=f.length;u<a;u++)i=f[u],e=$(i),o=parseInt(e.closest("g").attr("transform").match(/translate\(([0-9.]+),.+/)[1]),s=e.width(),o-n<r?t&&(e.attr("dy","2em"),t=!1):t=!0,n=o,l.push(r=s);return l},t.prototype.transferDataAttributes=function(e,t){var n,r,i,s,o;r=d3.selectAll(e)[0][0].attributes,o=[];for(i=0,s=r.length;i<s;i++)n=r[i],n.name.match(/^data-/)?o.push(t.attr(n.name,n.value)):o.push(void 0);return o},t.prototype.getTooltip=function(e,t,n){var r,i,s,o,u,a;return i=e.x,((o=this.options)!=null?(u=o.scale)!=null?(a=u.x)!=null?a.type:void 0:void 0:void 0)==="date"&&(i=d3.time.format("%Y-%m-%d %H:%M")(new Date(i))),s=e.y,typeof n=="function"&&(s=n(e)),r=this.svg.select(".line"+t).style("stroke"),this.getTooltipHtml(t,this.lines[t].title,r,this.xLabel,this.yLabel,i,s)},t.prototype.getTooltipHtml=function(e,t,n,r,i,s,o){return $("<div>").append($("<h6>").addClass("tooltip"+e).text(t).css("color",n)).append($("<table cellpadding='2'>").append($("<tr>").append($("<td align='left'>").text(r)).append($("<td align='left'>").append($("<b>").text(s)))).append($("<tr>").append($("<td align='left'>").text(i)).append($("<td align='left'>").append($("<b>").text(o))))).html()},t}(),{init:function(e){return new t(e)}}})}.call(this),function(){define("drawable/line_chart",["./generic_chart"],function(e){var t;return t=function(){function t(t){this.chart=e.init(t)}return t.prototype.generateLine=function(){var e=this;return d3.svg.line().x(function(t){return e.chart.xScale(t.x)}).y(function(t){return e.chart.yScale(t.y)})},t.prototype.drawLine=function(e,t){var n;return t==null&&(t=0),n=this.generateLine(),this.chart.svg.append("path").datum(e).attr("class","line line"+t+" visual"+t).attr("data-legend",this.chart.lineLabels[t]).attr("d",n)},t.prototype.drawDots=function(e,t){var n=this;return t==null&&(t=0),this.chart.svg.selectAll("dot").data(e).enter().append("circle").attr("class","dot dot"+t+" visual"+t).attr("r",4.5).attr("cx",function(e){return n.chart.xScale(e.x)}).attr("cy",function(e){return n.chart.yScale(e.y)}).attr("original-title",function(e){return n.chart.getTooltip(e,t)})},t.prototype.draw=function(){var e,t,n,r,i;this.chart.drawSvg(),this.chart.drawAxes(),i=this.chart.data;for(e=n=0,r=i.length;n<r;e=++n)t=i[e],this.drawLine(t,e),this.drawDots(t,e);return this.chart.drawLegend()},t}(),{init:function(e){return new t(e)}}})}.call(this),function(){define("drawable/bar_chart",["./generic_chart"],function(e){var t;return t=function(){function t(t){var n;t=$.extend(!0,{},t),n=t.scale.x.type,t.scale.x.type="ordinal",this.chart=e.init(t),t.scale.x.type=n}return t.prototype.drawBars=function(e,t){var n,r,i=this;return t==null&&(t=0),r=this.chart.xScale.rangeBand()/e.length,n=0,this.chart.svg.selectAll(".foo").data(e[t]).enter().append("rect").attr("class","bar bar"+t+" visual"+t+" line"+t+" line").attr("x",function(e){return i.chart.xScale(e.x)-n+t*r}).attr("y",function(e){return i.chart.yScale(e.y)}).attr("width",r).attr("height",function(e){return Math.max(0,i.chart.options.height-i.chart.yScale(e.y))}).attr("original-title",function(e){return i.chart.getTooltip(e,t)})},t.prototype.minInterval=function(e,t){var n,r,i,s,o;t==null&&(t=0),o=null,s=this.chart.data[t][0][e],i=1;while(i<this.chart.data[t].length){n=this.chart.data[t][i][e],r=n-s;if(!o||o>r)o=r;s=n,i+=1}return o},t.prototype.draw=function(){var e,t,n,r,i,s;this.chart.drawSvg(),this.chart.drawAxes(),i=this.chart.data,s=[];for(e=n=0,r=i.length;n<r;e=++n)t=i[e],s.push(this.drawBars(this.chart.data,e));return s},t.prototype.redraw=function(){return this.chart.svg=null,this.draw()},t}(),{init:function(e){return new t(e)}}})}.call(this),function(){define("drawable/carpet_chart",["./generic_chart","util/scale"],function(e,t){var n;return n=function(){function n(n){var r;this.chart=e.init(n),this.chart.options.scale.x.type="date",r=_(this.chart.data[0].map(function(e){return e.y})).uniq().sort(function(e,t){return e-t}),r.push(r[r.length-1]+1),this.chart.yScale.domain([r[0],r[r.length-1]]),this.rectWidth=t.getBarWidth(this.chart.data[0],this.chart.xScale,"x")+1,this.rectHeight=this.chart.options.height/(r.length-1)+1}return n.prototype.drawCarpet=function(e,t){var n=this;return t==null&&(t=0),this.color=d3.scale.linear().range(["#BF3030","#1D7373"]).domain(d3.extent(e.map(function(e){return e.v}))),this.chart.svg.selectAll(".carpet").data(e).enter().append("rect").attr("class","carpet").attr("x",function(e){return n.chart.xScale(e.x)}).attr("y",function(e){return n.chart.yScale(e.y)-n.rectHeight}).attr("fill",function(e){return n.color(e.v)}).attr("width",this.rectWidth).attr("height",this.rectHeight).attr("original-title",function(e){var r,i;return r=new Date(e.x),r.setHours(e.y),i=d3.time.format("%Y-%m-%d %H:%M")(r),n.chart.getTooltipHtml(t,n.chart.lines[t].title,n.chart.xLabel,n.chart.yLabel,i,e.v)})},n.prototype.drawLegend=function(){var e,t,n,r,i,s,o,u,a;r=this.chart.options.margin,s=d3.selectAll(this.chart.options.parent).append("svg").attr("class","legend").attr("width",150).attr("height",this.chart.options.height+r.bottom+r.top+30).append("g").attr("transform","translate(0,"+(r.top+30)+")"),t=this.color.domain()[0],i=(this.color.domain()[1]-t)/10,e=this.chart.options.height/10;for(n=u=0;u<10;n=++u)s.append("rect").attr("x",0).attr("y",n*e).attr("width",20).attr("height",e).attr("fill",this.color(t+(10-n+1)*i));for(n=a=0;a<=10;n=++a)o=n*e,n===0&&(o+=1),n===10&&(o-=1),s.append("line").attr("x1",20).attr("x2",26).attr("y1",o).attr("y2",o).attr("fill","#000000").attr("stroke","#000000"),s.append("text").attr("x",30).attr("y",n*e+3).text(Math.round((t+(10-n)*i)*1e3)/1e3);return s.append("text").attr("x",0).attr("y",-25).text(this.chart.options.yLabel).attr("font-weight","bold")},n.prototype.draw=function(){return this.chart.drawSvg(),this.chart.drawAxes(),this.drawCarpet(this.chart.data[0]),this.drawLegend()},n}(),{init:function(e){return new n(e)}}})}.call(this),function(){define("drawable/min_max_chart",["./generic_chart"],function(e){var t;return t=function(){function t(t){this.chart=e.init(t),this.chart.yScale.domain(d3.extent(this.getAllYs())),this.barWidth=this.calculateBarWidth(),this.barOffset=this.barWidth/2,this.chart.xScale.range([this.barOffset,this.chart.options.width-this.barOffset]),this.barWidth=this.calculateBarWidth(),this.barWidth*=.8,this.barOffset=this.barWidth/2}return t.prototype.calculateBarWidth=function(){var e,t,n;return e=this.chart.data[1],n=this.chart.xScale(e[0].x),t=this.chart.xScale(e[0].x+this.getSmallestDistance(e,"x")),t-n},t.prototype.generateLine=function(){var e=this;return d3.svg.line().x(function(t){return e.chart.xScale(t.x)}).y(function(t){return e.chart.yScale(t.y)})},t.prototype.drawLine=function(e,t){var n;return t==null&&(t=0),n=this.generateLine(),this.chart.svg.append("path").datum(e).attr("class","line line"+t+" visual"+t).attr("data-legend",this.chart.lineLabels[t]).attr("d",n)},t.prototype.drawDots=function(e,t){var n=this;return t==null&&(t=0),this.chart.svg.selectAll("dot").data(e).enter().append("circle").attr("class","dot dot"+t+" visual"+t).attr("r",4.5).attr("cx",function(e){return n.chart.xScale(e.x)}).attr("cy",function(e){return n.chart.yScale(e.y)}).attr("original-title",function(e){var r,i,s,o;return r=e.x,((i=n.chart.options)!=null?(s=i.scale)!=null?(o=s.x)!=null?o.type:void 0:void 0:void 0)==="date"&&(r=d3.time.format("%Y-%m-%d %H:%M")(new Date(r))),$("<div>").append($("<h6>").addClass("tooltip"+t).text(n.chart.lines[t].title)).append($("<table cellpadding='2'>").append($("<tr>").append($("<td align='left'>").text(n.chart.xLabel)).append($("<td align='left'>").append($("<b>").text(r)))).append($("<tr>").append($("<td align='left'>").text(n.chart.yLabel)).append($("<td align='left'>").append($("<b>").text(e.y))))).html()})},t.prototype.drawBars=function(e,t){var n=this;return t==null&&(t=0),this.chart.svg.selectAll(".foo").data(e).enter().append("rect").attr("class","bar bar"+t+" visual"+t+" line"+t+" line").attr("x",function(e){return n.chart.xScale(e.x)-n.barOffset}).attr("y",function(e){return n.chart.yScale(e.max)}).attr("width",this.barWidth).attr("height",function(e){return Math.max(0,n.chart.yScale(e.min)-n.chart.yScale(e.max))}).attr("original-title",function(e){return n.chart.getTooltip(e,t,function(e){return""+e.min+" - "+e.max})})},t.prototype.getAllYs=function(){var e;return e=[],_(this.chart.options.disabledLines).contains(0)||(e=e.concat(this.chart.data[0].map(function(e){return e.y}))),_(this.chart.options.disabledLines).contains(1)||(e=e.concat(this.chart.data[1].map(function(e){return e.min})),e=e.concat(this.chart.data[1].map(function(e){return e.max}))),e},t.prototype.getSmallestDistance=function(e,t){var n,r,i,s,o;t==null&&(t="x"),i=Infinity;for(r=s=0,o=e.length-2;0<=o?s<o:s>o;r=0<=o?++s:--s)n=Math.abs(e[r+1][t]-e[r][t]),n<i&&(i=n);return i},t.prototype.draw=function(){return this.chart.drawSvg(),this.chart.drawAxes(),this.chart.svg.select(".x.axis path").attr("d","M0,6V0H"+this.chart.options.width+"V6"),this.drawBars(this.chart.data[1],1),this.drawLine(this.chart.data[0],0),this.drawDots(this.chart.data[0],0),this.chart.drawLegend()},t.prototype.redraw=function(){return this.chart.svg=null,this.draw()},t}(),{init:function(e){return new t(e)}}})}.call(this),function(){define("drawable/pos_neg_chart",["./generic_chart","util/scale"],function(e,t){var n;return n=function(){function n(n){var r;this.chart=e.init(n),r=this.chart.yScale.domain(),r[0]=Math.min(0,r[0]),r[1]=Math.max(0,r[1]),this.chart.yScale.domain(r),this.barWidth=t.getBarWidth(this.chart.data[1],this.chart.xScale,"x"),this.barOffset=this.barWidth/2,this.chart.xScale.range([this.barOffset,this.chart.options.width-this.barOffset]),this.barWidth=t.getBarWidth(this.chart.data[1],this.chart.xScale,"x"),this.barWidth*=.8,this.barOffset=this.barWidth/2}return n.prototype.drawBars=function(e,t,n){var r,i,s=this;return t==null&&(t=0),n==null&&(n=!0),i=function(e){return n?s.chart.yScale(e.y):s.chart.yScale(0)},r=function(e){return n?Math.max(0,s.chart.yScale(0)-s.chart.yScale(e.y)):Math.max(0,s.chart.yScale(e.y)-s.chart.yScale(0))},this.chart.svg.selectAll(".foo").data(e).enter().append("rect").attr("class","bar bar"+t+" visual"+t+" line"+t+" line").attr("x",function(e){return s.chart.xScale(e.x)-s.barOffset}).attr("y",i).attr("width",this.barWidth).attr("height",r).attr("original-title",function(e){return s.chart.getTooltip(e,t)})},n.prototype.draw=function(){return this.chart.drawSvg(),this.chart.drawAxes(),this.chart.svg.select(".x.axis path").attr("d","M0,6V0H"+this.chart.options.width+"V6"),this.drawBars(this.chart.data[0],0,!0),this.drawBars(this.chart.data[1],1,!1),this.chart.drawLegend()},n}(),{init:function(e){return new n(e)}}})}.call(this),function(){define("components/visual",["drawable/line_chart","drawable/bar_chart","drawable/carpet_chart","drawable/min_max_chart","drawable/pos_neg_chart"],function(e,t,n,r,i){return flight.component(function(){var s;return s={line:e,bar:t,minmax:r,posneg:i,carpet:n},this.applyNavigation=function(e){return this.attr.chartOptions.xLabel=e.xAxisLabel,this.attr.chartOptions.yLabel=e.yAxisLabel,this.attr.chartOptions.scale={x:{type:e.isDateScale?"date":"linear"}}},this.getChart=function(t){var n,r;return this.attr.chartOptions.lines=t,n=(r=s[this.attr.type])!=null?r:e,n.init(this.attr.chartOptions)},this.hideDisabledLines=function(e){var t,n,r,i;i=[];for(n=0,r=e.length;n<r;n++)t=e[n],this.$node.find(".line"+t).hide(),i.push(this.$node.find(".dot"+t).hide());return i},this.draw=function(e,t){var n;return this.$node.empty(),this.attr.chartOptions.disabledLines=t.disabledLines,this.applyNavigation(t.navigation),n=this.getChart(t.data),n.draw(),this.hideDisabledLines(t.disabledLines),this.setupTooltips()},this.setupTooltips=function(){return this.$node.find("circle").tipsy({gravity:"sw",html:!0,opacity:.95}),this.$node.find("rect").tipsy({gravity:"sw",html:!0,opacity:.95})},this.after("initialize",function(){return this.on("draw",this.draw),this.attr.chartOptions={parent:this.$node,width:this.attr.width,height:this.attr.height}})})})}.call(this),function(){define("components/productSelection",[],function(){return flight.component(function(){return this.productParts=["type","posneg","timeslot"],this.refresh=function(e){return this.attr.navigationData=e,this.createElements(),this.setupEvents(),this.fillTso(),this.fillProduct(),this.select("tso").val(e.defaults.tsoId),this.setProduct(e.defaults.product),this.select("tso").change()},this.createElements=function(){var e,t,n,r,i;this.$node.empty(),this.$node.append($("<select>").addClass("tso")),t=$("<div>").addClass("product").css("display","inline"),i=this.productParts;for(n=0,r=i.length;n<r;n++)e=i[n],t.append($("<select>").addClass(e));return this.$node.append(t)},this.setupEvents=function(){var e=this;return this.$node.find("select").change(function(){var t,n;return n=e.select("tso").val(),t=e.normalizeProduct(),e.trigger("productSelectionChanged",{tso:n,product:t}),e.setProduct(t)})},this.fillTso=function(){var e,t,n,r,i;e=this.select("tso"),r=this.attr.navigationData.tsos,i=[];for(t in r)n=r[t],i.push(e.append($("<option>").val(t).text(n)));return i},this.fillProduct=function(){return this.setProduct(111)},this.setProduct=function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g;e=""+e,u={};for(r=a=0,p=this.productParts.length;0<=p?a<p:a>p;r=0<=p?++a:--a)i=parseInt(e.substring(r,r+1)),u[this.productParts[r]]=i;o=this.getProductTree().root,d=this.productParts,g=[];for(r=f=0,c=d.length;f<c;r=++f){s=d[r],n=this.select("product").find("."+s),n.empty(),v=o.children;for(l=0,h=v.length;l<h;l++)t=v[l],n.append($("<option>").val(t.id).text(t.name));o.children.length<=1?n.hide():n.show(),i=u[s],n.val(i),g.push(o=(m=_.find(o.children,function(e){return e.id===i}))!=null?m:o.children[0])}return g},this.getProduct=function(){var e,t,n,r,i,s;n="",s=this.productParts;for(r=0,i=s.length;r<i;r++)t=s[r],e=this.select("product").find("."+t),n+=e.val();return n},this.normalizeProduct=function(){var e;return e=this.getProduct(),this.setProduct(e),this.getProduct()},this.getProductTree=function(){var e,t;return t=this.select("tso").val(),e=_(this.attr.navigationData.productTrees).find(function(e){return e.tso===t}),e!=null?e:this.attr.navigationData.productTrees[0]},this.defaultAttrs({tso:".tso",product:".product"}),this.after("initialize",function(){var e=this;return this.on("refresh",function(t,n){return e.refresh(n.data)}),this.on("updateProducts",function(t,n){return e.refresh(n.data)})})})})}.call(this),function(){define("util/time_utils",[],function(){return{modifyDate:function(e,t,n){var r,i,s,o;s=new Date(e),r=parseInt(t.days),i=parseInt(t.months),o=parseInt(t.years);if(n!=null?n:t.backwards)r*=-1,i*=-1,o*=-1;return isNaN(r)||s.setDate(s.getDate()+r),isNaN(i)||s.setMonth(s.getMonth()+i),isNaN(o)||s.setFullYear(s.getFullYear()+o),s},getDateModifier:function(e){switch(e){case"Day":return{days:1};case"Week":return{days:7};case"Month":return{months:1};case"Year":return{years:1};default:return{}}},normalizeDate:function(e,t){var n;n=new Date(e);switch(t){case"Week":n=this.getWeekStart(n);break;case"Month":n.setDate(1);break;case"Year":n.setMonth(0),n.setDate(1)}return n},addRange:function(e,t){var n;return n=this.getDateModifier(t),this.modifyDate(e,n)},subtractRange:function(e,t){var n;return n=this.getDateModifier(t),n.backwards=!0,this.modifyDate(e,n)},getWeekStart:function(e){var t;t=new Date(e);while(t.getDay()!==1)t.setDate(t.getDate()-1);return t},timeRangeLiteral:function(e){var t;return t=e.to-e.from,t<6048e5?"Day":t<24192e5?"Week":t<31536e6?"Month":"Year"},timeRangePrototype:function(e){var t;return t=new Date,{from:t,to:this.addRange(t,e)}},dataSetCount:function(e,t){var n,r,i;e.from=new Date(e.from),e.to=new Date(e.to),n=e.to-e.from;switch(t){case"QUATER_HOURLY":return n/9e5;case"HOURLY":return n/36e5;case"DAILY":return n/864e5;case"WEEKLY":return n/6048e5;case"MONTHLY":return i=e.to.getFullYear()-e.from.getFullYear(),r=e.to.getMonth()-e.from.getMonth(),i*12+r;case"YEARLY":return e.to.getFullYear()-e.from.getFullYear()}},asUTC:function(e){return new Date(e.getTime()+e.getTimezoneOffset()*60*1e3)},fromUTC:function(e){return new Date(e.getTime()-e.getTimezoneOffset()*60*1e3)},isInTimeRange:function(e,t){return e>=t.from&&e<=t.to},isTimeRangeInside:function(e,t){return this.isInTimeRange(e.from,t)&&this.isInTimeRange(e.to,t)},nearestInTimeRange:function(e,t){var n,r;return n=new Date(t.from),r=new Date(t.to),new Date(e<n?n:e<=r?e:r)},normalizedToTimeRange:function(e,t){e=new Date(e),e.setMilliseconds(0),e.setSeconds(0),e.setMinutes(0),e.setHours(0);switch(t){case"Month":e.setDate(1);break;case"Year":e.setDate(1),e.setMonth(0)}return e},mergeDate:function(e,t,n,r){var i;switch(r){case"Day":return n==="Week"?TimeUtils.getWeekStart(t):t;case"Week":return i=new Date(e),i.setMonth(t.getMonth()),i.setFullYear(t.getFullYear()),i;case"Month":return i=new Date(e),i.setMonth(t.getMonth()),i.setFullYear(t.getFullYear()),i;case"Year":return i=new Date(e),i.setFullYear(t.getFullYear()),i}},timeRangeDateFormat:{Day:"yyyy-mm-dd",Week:"yyyy-mm-dd",Month:"yyyy-mm",Year:"yyyy"},resolutionDateFormat:{QUATER_HOURLY:d3.time.format("%Y-%m-%d %H:%M"),HOURLY:d3.time.format("%Y-%m-%d %H:%M"),DAILY:d3.time.format("%Y-%m-%d"),WEEKLY:d3.time.format("%Y-%m-%d"),MONTHLY:d3.time.format("%Y-%m"),YEARLY:d3.time.format("%Y")}}})}.call(this),function(){define("util/resolution",[],function(){var e,t,n;return n={QUATER_HOURLY:900,HOURLY:3600,DAILY:86400,WEEKLY:604800,MONTHLY:2592e3,YEARLY:31536e3},e={line:{optimalDensity:25,maximumDensity:15},bar:{optimalDensity:30,maximumDensity:25},minmax:{optimalDensity:25,maximumDensity:15},posneg:{optimalDensity:25,maximumDensity:15}},t=["bar"],{getOptimalResolution:function(r,i,s,o,u){var a,f,l,c,h,p,d,v,m,g,y;u==null&&(u=1);if(s==null||s.length===0)return null;if(r==="carpet")return"HOURLY";v=o/e[r].optimalDensity,d=o/e[r].maximumDensity,_.contains(t,r)&&(v/=u,d/=u),h=(i.to-i.from)/1e3,m=_(_(n).keys()).filter(function(e){return _(s).contains(e)}),l=m.map(function(e){return[e,h/n[e]]}),a=l[0];for(p=g=1,y=l.length;1<=y?g<y:g>y;p=1<=y?++g:--g){f=Math.abs(a[1]-v),c=Math.abs(l[p][1]-v);if(a[1]>d){if(l[p][1]<=d||c<f)a=l[p]}else c<f&&l[p][1]<d&&(a=l[p])}return a[0]}}})}.call(this),function(){define("components/timeSelection",["../util/time_utils","../util/resolution"],function(e,t){return flight.component(function(){return this.dateFormat=d3.time.format("%Y-%m-%d"),this.datePickerFormat="yyyy-mm-dd",this.timeRanges=["Day","Week","Month","Year"],this.viewModes={Day:"days",Week:"days",Month:"months",Year:"years"},this.refresh=function(t){var n,r,i,s,o,u,a;this.attr.navigationData=t,this.createElements(),this.setupEvents(),n={from:new Date(t.timeRangeMax.from),to:new Date(t.timeRangeMax.to)},this.fillDatePickers(n),this.fillTimeRange(),r=t.defaults.timeRange,i=e.timeRangeLiteral(r),a=_(this.attr.streams).values();for(o=0,u=a.length;o<u;o++)s=a[o],s["in"].push(new Date(r.from));return this.select("timeRange").val(i).change()},this.setupEvents=function(){var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g=this;return h=this.select("timeRange"),p=h.asEventStream("change",function(){return h.val()}),d=this.$node.asEventStream("timeRestrictions",function(e,t){return t}),c=this.select("prevPeriode").asEventStream("click"),l=this.select("nextPeriode").asEventStream("click"),i=p.combine(d,function(e,t){var n,r;return n=new Date(t.from),r=new Date(t.to),[n,r]}),this.attr.streams=s={},this.timeRanges.forEach(function(t){var n;return n=s[t]={},n["in"]=new Bacon.Bus,n.sync=new Bacon.Bus,n.out=new Bacon.Bus,Bacon.combineAsArray(n.sync,n["in"]).sampledBy(p,function(){return arguments}).onValue(function(r){var i,s,o,u,a,f;a=r[0],f=a[0],o=f[0],s=f[1],i=a[1],u=r[1];if(u===t)return i=e.mergeDate(i,o,u,s),n["in"].push(i)}),n.valid=i.combine(n["in"],function(n,r){var i,s,o;return i=n[0],o=n[1],s={from:i,to:o},r=e.nearestInTimeRange(r,s),r=e.normalizedToTimeRange(r,t),r=e.nearestInTimeRange(r,s),[r,t]}),n.currentValid=Bacon.combineAsArray(n.valid,p).flatMap(function(e){var t,n,r,i;return i=e[0],n=i[0],r=i[1],t=e[1],r===t?Bacon.once([n,r]):Bacon.never()}),n.fire=n.valid.sampledBy(n.out,function(e){var t,n;return t=e[0],n=e[1],t})}),a=_(s).chain().values().map(function(e){return e.fire}).value(),f=Bacon.mergeAll.apply(Bacon,a),m=_(s).chain().values().map(function(e){return e.valid.toEventStream()}).value(),v=Bacon.mergeAll.apply(Bacon,m),n=_(s).chain().values().map(function(e){return e.currentValid.toEventStream()}).value(),t=Bacon.mergeAll(n),t.toProperty().sampledBy(c).onValue(function(t){var n,r;return n=t[0],r=t[1],n=e.subtractRange(n,r),s[r]["in"].push(n),s[r].out.push()}),t.toProperty().sampledBy(l).onValue(function(t){var n,r;return n=t[0],r=t[1],n=e.addRange(n,r),s[r]["in"].push(n),s[r].out.push()}),r=Bacon.combineWith(function(t,n){var r,i,s;return r=t[0],i=t[1],s=e.addRange(r,i),s=e.nearestInTimeRange(s,n),[r,s]},t,d),u=this.$node.asEventStream("requestTimeSelection"),o=this.attr.fireBus=new Bacon.Bus,o.plug(u),o.plug(f),o.plug(p),i.onValue(function(e){var t,n,r,i,s,o,u,a;n=e[0],i=e[1],u=g.timeRanges,a=[];for(s=0,o=u.length;s<o;s++)r=u[s],t=g.getDatepickerElement(r),t.datepicker("setStartDate",n),a.push(t.datepicker("setEndDate",i));return a}),v.onValue(function(e){var t,n,r;return t=e[0],r=e[1],n=g.getDatepickerElement(r),n.datepicker("setDate",t)}),p.toProperty().sampledBy(f,function(){return arguments}).onValue(function(e){var t,n,r,i,o,u,a;n=e[0],t=e[1],u=g.timeRanges,a=[];for(i=0,o=u.length;i<o;i++)r=u[i],a.push(s[r].sync.push([t,n]));return a}),r.sampledBy(o).onValue(function(e){var t,n;return t=e[0],n=e[1],g.trigger("timeSelectionChanged",{timeRange:{from:t,to:n}})}),this.timeRanges.forEach(function(e){var t;return t=g.getDatepickerElement(e),t.on("changeDate",function(t){return s[e]["in"].push(t.date),s[e].out.push()})}),this.$node.find(".datepicker-generic").each(function(e,t){return $(t).find(".fromIcon").click(function(){return $(t).find(".from").datepicker("show")})}),p.onValue(function(e){var t,n,r,i,s,o;s=g.timeRanges,o=[];for(r=0,i=s.length;r<i;r++)n=s[r],t=g.$node.find(".datepicker-"+n),n===e?o.push(t.show()):o.push(t.hide());return o})},this.createElements=function(){var e=this;return this.$node.empty(),this.timeRanges.forEach(function(t){return e.$node.append($("<div>").addClass("input-append").addClass("datepicker-generic").addClass("datepicker-"+t).append($("<input>").attr("type","text").addClass("from").attr("readonly",!0)).append($("<span>").addClass("add-on").addClass("calendar").addClass("fromIcon").append($("<i>").addClass("icon-th"))).hide())}),this.$node.append($("<div>").addClass("prevPeriode").append($("<i>").addClass("icon-chevron-left"))),this.$node.append($("<select>").addClass("timerange")),this.$node.append($("<div>").addClass("nextPeriode").append($("<i>").addClass("icon-chevron-right")))},this.fillTimeRange=function(){var e,t,n,r,i,s,o;e=this.select("timeRange"),s=this.timeRanges,o=[];for(r=0,i=s.length;r<i;r++){t=s[r];if(!_(this.attr.navigationData.timeRanges).contains(t))continue;n=this.attr.navigationData.localizations.timeRanges[t],o.push(e.append($("<option>").val(t).text(n)))}return o},this.fillDatePickers=function(t){var n=this;return t==null&&(t={}),this.timeRanges.forEach(function(r){var i,s,o,u;return i=n.getDatepickerElement(r),i.datepicker({format:e.timeRangeDateFormat[r],weekStart:1,calendarWeeks:r==="Week",weekselect:r==="Week",viewMode:n.viewModes[r],minViewMode:n.viewModes[r],startDate:(s=t.from)!=null?s:"1900-01-01",endDate:(o=t.to)!=null?o:new Date,language:(u=n.attr.navigationData.localizations.locale)!=null?u:"de"})})},this.getDatepickerElement=function(e){return this.$node.find(".datepicker-"+e+" .from")},this.defaultAttrs({timeRange:".timerange",prevPeriode:".prevPeriode",nextPeriode:".nextPeriode"}),this.after("initialize",function(){var e=this;return this.attr.fromDateBus=new Bacon.Bus,this.on("refresh",function(t,n){return e.refresh(n.data)})})})})}.call(this),function(){define("components/lines",[],function(){return flight.component(function(){var e,t;return e=function(e,t){var n;return n=e.attr("class"),n+=" "+t,e.attr("class",n)},t=function(e,t){var n;return n=e.attr("class"),n=n.replace(new RegExp("s*"+t+"s*","g"),""),e.attr("class",n)},this.updateLines=function(n,r){var i,s,o,u,a,f,l,c,h,p=this;this.$node.empty(),s=$("<ul>"),this.$node.append(s),function(){c=[];for(var e=0,t=r.lines.length;0<=t?e<t:e>t;0<=t?e++:e--)c.push(e);return c}.apply(this).forEach(function(n){var i,o,u;return i=p.$node.closest(".chart,.download").find("svg .line"+n).css("stroke"),u=r.lines[n],o=$("<li>").addClass("line"+n).append($("<table>").attr("cellpadding","3").append($("<tr>").append($("<td>").append($("<div>").addClass("linesquare").css("background-color",i))).append($("<td>").text(u.title)))),o.click(function(){return _.contains(p.attr.disabledLines,n)?p.attr.disabledLines=_.without(p.attr.disabledLines,n):p.attr.disabledLines.push(n),o.toggleClass("hidden"),p.trigger("toggleLine",{disabledLines:p.attr.disabledLines})}),o.hover(function(){return p.$node.closest(".chart").find(".line"+n).each(function(){return e($(this),"selected"),$(this).show()}),p.$node.closest(".chart").find(".dot"+n).each(function(){return e($(this),"selected"),$(this).show()})},function(){p.$node.closest(".chart").find(".line"+n).each(function(){return t($(this),"selected")}),p.$node.closest(".chart").find(".dot"+n).each(function(){return t($(this),"selected")});if(o.hasClass("hidden"))return p.$node.closest(".chart").find(".visual .line"+n).hide(),p.$node.closest(".chart").find(".visual .dot"+n).hide()}),s.append(o)}),this.trigger("toggleLine",{disabledLines:this.attr.disabledLines}),l=this.attr.disabledLines,h=[];for(u=0,a=l.length;u<a;u++)i=l[u],h.push(this.$node.find("li.line"+i).addClass("hidden"));return h},this.after("initialize",function(){return this.attr.disabledLines=[],this.on("updateLines",this.updateLines),this.on("disabledLines",function(e,t){if(t.lines!=null)return this.attr.disabledLines=t.lines})})})})}.call(this),function(){define("components/infobox",[],function(){return flight.component(function(){return this.createElements=function(){return this.$node.append($("<table>"))},this.update=function(e){var t,n,r,i,s,o,u,a,f;return r=e.navigationData.localizations,n=r.infoKeys,o=e.selections,t=d3.time.format("%Y-%m-%d"),a=r.title,u=t(e.selections.timeRange.from)+" - "+t(e.selections.timeRange.to),s=r.resolutions[o.resolution],f=r.tsos[o.tso],i="",this.$node.closest(".chart").find(".productSelection select").slice(1,4).each(function(){return i+=$(this).find("option:selected").text()+" "}),this.select("table").empty(),this.select("table").attr("cellpadding",3).append($("<tr>").append($("<td>").text(n.title)).append($("<td>").append($("<b>").text(e.navigationData.title)))).append($("<tr>").append($("<td>").text(n.product)).append($("<td>").append($("<b>").text(i)))).append($("<tr>").append($("<td>").text(n.timerange)).append($("<td>").append($("<b>").text(u)))).append($("<tr>").append($("<td>").text(n.resolution)).append($("<td>").append($("<b>").text(s)))).append($("<tr>").append($("<td>").text(n.tso)).append($("<td>").append($("<b>").text(f))))},this.defaultAttrs({table:"table"}),this.after("initialize",function(){var e=this;return this.createElements(),this.on("updateInfo",function(t,n){return e.update(n)})})})})}.call(this),function(){define("components/chart_download",[],function(){return flight.component(function(){return this.createElements=function(){var e=this;return this.$node.append($("<button>").addClass("downloadSvg").addClass("btn").text("Download SVG").click(function(){return e.doPostRequest("svg",{svgData:e.getSvgDump()})})),this.$node.append($("<button>").addClass("downloadPng").addClass("btn").text("Download PNG").click(function(){return e.doPostRequest("png",{svgData:e.getSvgDump()})}))},this.doPostRequest=function(e,t){var n,r;n=$("<form>").attr("action",e).attr("method","POST");for(r in t)n.append($("<input>").attr("type","text").attr("name",r).val(t[r]));return n.appendTo(this.$node).submit().remove()},this.getSvgDump=function(){var e;return e=this.$node.closest(".chart").find("svg").clone(),e.attr({version:"1.1",xmlns:"http://www.w3.org/2000/svg"}),this.removeTooltip(e),$("<div>").append(e).html()},this.removeTooltip=function(e){var t,n,r,i;i=$(e).children();for(n=0,r=i.length;n<r;n++)t=i[n],this.removeTooltip(t);return $(e).removeAttr("original-title"),$(e).removeAttr("data-legend")},this.after("initialize",function(){var e=this;return this.createElements(),this.on("downloadLink",function(){var t,n;return $("svg").attr({version:"1.1",xmlns:"http://www.w3.org/2000/svg"}),n=e.$node.closest(".chart").find(".visual").html(),n=n.replace(/<svg.*?>/,"").replace("</svg>",""),t=$('link[href$="chart.css"]').attr("href"),$.ajax(t,{error:function(){return alert("Error while preparing download")},success:function(t){return t=$.base64.encode("<svg><style>"+t+"</style>"+n+"</svg>"),e.$node.find("a.downloadSvg").attr("href","data:image/svg;base64,"+t)}})})})})})}.call(this),function(){define("components/data_sheet",["../util/time_utils"],function(e){return flight.component(function(){return this.createElements=function(){return this.$node.empty(),this.$node.append($("<table>"))},this.refresh=function(t,n){var r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k;f=this.select("table"),f.empty(),a=t[0].resolution,i=e.resolutionDateFormat[a],r={};for(p=0,g=t.length;p<g;p++){o=t[p],T=o.dataPoints;for(d=0,y=T.length;d<y;d++)s=T[d],r[x=s.x]==null&&(r[x]=[]),r[s.x].push(s.y)}l=$("<tr>").addClass("header"),l.append($("<td>").text(n.xAxisLabel));for(v=0,b=t.length;v<b;v++)o=t[v],l.append($("<td>").text(o.title+" ["+o.unit+"]"));f.append(l),u=!0,N=_(r).keys().sort(),k=[];for(m=0,w=N.length;m<w;m++){c=N[m],l=$("<tr>").addClass(u?"odd":"even"),l.append($("<td>").text(n.isDateScale?i(new Date(parseInt(c))):c)),C=r[c];for(S=0,E=C.length;S<E;S++)h=C[S],l.append($("<td>").text(h));f.append(l),k.push(u=!u)}return k},this.defaultAttrs({dateFormat:d3.time.format("%Y-%m-%d %H:%M"),table:"table"}),this.after("initialize",function(){var e=this;return this.on("refresh",function(t,n){return e.refresh(n.lines,n.navigationData)}),this.createElements()})})})}.call(this),function(){define("util/loading",[],function(){return{showText:function(e,t,n,r){var i;return n==null&&(n=960),r==null&&(r=600),e=d3.selectAll(e),i=e.select("svg"),i.empty()?i=e.append("svg").attr("width",n).attr("height",r):(n=parseInt(i.attr("width")),r=parseInt(i.attr("height"))),i.selectAll("*").remove(),i.append("g").attr("transform","translate("+n/2+","+r/2+")").append("text").attr("font-size","24").style("text-anchor","middle").text(t)},showLoading:function(e,t,n){return this.showText(e,"Loading...",t,n)},of:function(e,t,n){var r=this;return{showText:function(i){return r.showText(e,i,t,n)},showLoading:function(){return r.showLoading(e,t,n)}}}}})}.call(this),function(){define("util/lines_preprocessor",[],function(){var e;return e=function(e){return e},{transformers:{minmax:function(e){var t,n,r,i,s,o,u;e=$.extend(!0,{},e),i=[],i.push(e[1]),r=e[0],r.title+=" / "+e[2].title,u=r.dataPoints;for(n=s=0,o=u.length;s<o;n=++s)t=u[n],t.min=t.y,t.max=e[2].dataPoints[n].y;return i.push(r),i},carpet:function(e){var t,n,r,i,s,o,u;e=$.extend(!0,{},e),i=e[0],r=d3.time.format("%H"),u=i.dataPoints;for(s=0,o=u.length;s<o;s++)n=u[s],t=new Date(n.x),n.v=n.y,n.y=parseInt(r(t)),t.setHours(0),t.setMinutes(0),t.setSeconds(0),t.setMilliseconds(0),n.x=t.getTime();return[i]},posneg:function(e){var t,n,r,i;e=$.extend(!0,{},e),i=e[1].dataPoints;for(n=0,r=i.length;n<r;n++)t=i[n],t.y*=-1;return[e[0],e[1]]}},transform:function(t,n){var r,i;return r=(i=this.transformers[t])!=null?i:e,r(n)}}})}.call(this),function(){define("util/product_tree",[],function(){var e;return e=function(){function e(e){var t,n,r,i;this.trees={},i=e.productTrees;for(n=0,r=i.length;n<r;n++)t=i[n],this.trees[parseInt(t.tso)]=t}return e.prototype.tree=function(e){return this.trees[parseInt(e)]},e.prototype.traverse=function(e,t){var n,r,i,s,o,u,a;o=this.tree(e),i=o.root,s=t+"";for(n=u=0,a=s.length;0<=a?u<a:u>a;n=0<=a?++u:--u)r=parseInt(s[n]),i=_(i.children).find(function(e){return e.id===r});return i},e}(),{init:function(t){return new e(t)}}})}.call(this),function(){define("components/chart_manager",["components/visual","components/productSelection","components/timeSelection","components/lines","components/infobox","components/chart_download","components/data_sheet","util/loading","util/lines_preprocessor","util/resolution","util/product_tree","util/time_utils"],function(e,t,n,r,i,s,o,u,a,f,l,c){return flight.component(function(){return this.applyVisibility=function(){var e,t,n;return e=this.$node.find(".lines"),t=this.$node.find(".productSelect"),n=this.$node.find(".timeselect"),this.attr.navigationData.hasLineSelection?e.show():e.hide(),this.attr.navigationData.hasProductSelection?t.show():t.hide(),this.attr.navigationData.hasTimeSelection?n.show():n.hide()},this.getMsg=function(){var e,t;return u.of(this.select("visual"),(e=this.attr.navigationData)!=null?e.width:void 0,(t=this.attr.navigationData)!=null?t.height:void 0)},this.getNavigationData=function(e){var t=this;return $.ajax("navigation",{data:{chartId:this.attr.id},error:function(t){return e(t)},success:function(n){return t.logDebug("Got navigation data:"),console.log(n),t.navigationData=n,e(null,n)}})},this.getLines=function(e,t){var n,r=this;return this.getMsg().showLoading(),n=d3.time.format("%Y-%m-%d"),$.ajax("lines",{data:{chartId:this.attr.id,product:e.product,tso:e.tso,startTime:n(e.timeRange.from),endTime:n(e.timeRange.to),resolution:e.resolution},success:function(e){return t(null,e)},error:function(e){return t(e)}})},this.reportDisabledLines=function(e){var t=this;return $.ajax("disabledLines",{type:"POST",data:{chartId:this.attr.id,lines:e.join(",")},error:function(e,n,r){return t.logError("Error while reporting disabled lines: "+r)},success:function(){return t.logDebug("Sent disabled lines")}})},this.onGetLines=function(e){var t,n=this;t=this.attr.treeHelper.traverse(e.tso,e.product);if(!c.isTimeRangeInside(e.timeRange,t.timeRange)){this.logDebug("No line request made due to time restrictions");return}return e.resolution=this.optimalResolution(e),this.logDebug("Getting lines:"),this.logDebug(JSON.stringify(e)),e.title=this.attr.navigationData.title,this.trigger(this.select("infobox"),"updateInfo",{navigationData:this.attr.navigationData,selections:e}),this.getLines(e,function(e,t){return e!=null?(n.logError(e),n.trigger("chartMessage",{msg:"Sorry, something went wrong."})):t.length===0?n.trigger("chartMessage",{msg:"No data"}):(n.attr.chartLines=a.transform(n.attr.type,t),n.triggerDraw(n.attr.chartLines),n.trigger(n.select("lines"),"updateLines",{lines:n.attr.chartLines}),n.trigger(n.select("dataSheet"),"refresh",{lines:t,navigationData:n.attr.navigationData}))})},this.triggerDraw=function(e){return e.length===this.attr.disabledLines.length?this.trigger("chartMessage",{msg:"No lines selected"}):(this.trigger(this.select("visual"),"draw",{data:e,navigation:this.attr.navigationData,disabledLines:this.attr.disabledLines}),this.trigger(this.select("chartDownload"),"downloadLink"))},this.toggleLine=function(e,t){return this.attr.disabledLines=t.disabledLines,this.reportDisabledLines(t.disabledLines),this.triggerDraw(this.attr.chartLines)},this.optimalResolution=function(e){var t;return t=this.attr.treeHelper.traverse(e.tso,e.product),f.getOptimalResolution(this.attr.type,e.timeRange,t.resolution,this.attr.width,this.attr.navigationData.aspects.length)},this.defaultAttrs({navigation:".navigation",visual:".visual",lines:".lines",infobox:".infobox",productSelection:".productSelection",timeSelection:".timeSelection",chartDownload:".chartDownload",dataSheet:".dataSheet",disabledLines:[]}),this.after("initialize",function(){var u,a,f,c,h,p,d,v,m,g,y,b,w,E,S,x,T=this;return this.logDebug=Logger.logDebug("ChartManager"),this.logError=Logger.logError("ChartManager"),this.on("getLines",this.onGetLines),this.on("toggleLine",this.toggleLine),this.on("errorMessage",function(e,t){return this.$node.text(t.msg)}),this.on("chartMessage",function(e,t){return this.getMsg().showText(t.msg)}),v=function(){return!1},w=function(e,t){return(new Date(e.timeRange.from)).getTime()===(new Date(t.timeRange.from)).getTime()&&(new Date(e.timeRange.to)).getTime()===(new Date(t.timeRange.to)).getTime()},m=this.$node.asEventStream("productSelectionChanged",function(e,t){return t}),E=this.$node.asEventStream("timeSelectionChanged",function(e,t){return t}),y=m.toProperty().sampledBy(E,$.extend),y.onValue(function(e){return T.onGetLines(e)}),m.onValue(function(e){var t;return t=T.attr.treeHelper.traverse(e.tso,e.product),T.trigger(T.select("timeSelection"),"timeRestrictions",t.timeRange),T.trigger(T.select("timeSelection"),"requestTimeSelection")}),this.attr.type=(x=this.$node.attr("data-chart-type"))!=null?x:"line",this.attr.width=parseInt(this.$node.attr("data-width")),this.attr.height=parseInt(this.$node.attr("data-height")),isNaN(this.attr.width)&&(this.attr.width=800),isNaN(this.attr.height)&&(this.attr.height=800),S=$("<div>").addClass("visual"),this.$node.append(S),e.attachTo(S,this.attr),f=$("<div>").addClass("controls").css("width",""+this.attr.width+"px"),this.$node.append(f),h=$("<div>").addClass("infobox"),f.append(h),i.attachTo(h),this.attr.type!=="carpet"&&(p=$("<div>").addClass("lines"),f.append(p),r.attachTo(p)),g=$("<div>").addClass("selection"),f.append(g),d=$("<div>").addClass("productSelection"),g.append(d),t.attachTo(d,this.attr),b=$("<div>").addClass("timeSelection"),g.append(b),n.attachTo(b,this.attr),u=$("<div>").addClass("buttons"),f.append(u),a=$("<div>").addClass("chartDownload"),u.append(a),s.attachTo(a,this.attr),u.append($("<a>").addClass("downloadCsv").attr("href","download?chartId="+this.attr.id).append("<button>").addClass("btn").text("Download CSV")),u.append($("<button>").addClass("btn").addClass("datasheet").text("Data sheet").click(function(){return T.select("dataSheet").toggle()})),c=$("<div>").addClass("dataSheet").hide(),f.append(c),o.attachTo(c,this.attr),this.getMsg().showText("Loading..."),this.getNavigationData(function(e,t){var n;return e!=null?(T.logError(e),T.trigger("errorMessage",{msg:"Sorry, something went wrong."})):typeof t=="object"&&(t!=null?(n=t.allResolutions)!=null?n.length:void 0:void 0)>0?(T.attr.navigationData=t,T.attr.treeHelper=l.init(t),T.applyVisibility(),T.$node.find(".datasheet").text(t.localizations.infoKeys.datasheet),T.trigger(T.select("lines"),"disabledLines",{lines:_(t.defaults.disabledLines).values()}),T.trigger(T.select("timeSelection"),"refresh",{data:t}),T.trigger(T.select("productSelection"),"refresh",{data:t})):T.trigger("errorMessage",{msg:"Sorry, you do not have the permission to see this chart."})})})})})}.call(this),function(){require.config({baseUrl:"/enwida/resources/js/chart/lib"}),require(["util/logger","components/chart_manager"],function(e,t){return $(document).ready(function(){return window.Logger=e.init("debug"),$(".chart").each(function(){var e;return e=$(this).attr("data-chart-id"),t.attachTo($(this),{id:e})})})})}.call(this),define("../charts",function(){});